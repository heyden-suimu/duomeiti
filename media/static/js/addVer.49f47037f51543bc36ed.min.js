webpackJsonp([11,12],{142:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(9),s=o(a),i=r(8),l=o(i),n=(r(14),r(10)),c=r(34);t.default={data:function(){return{userlist:"",hastype:"disabled",blur:!1,input_check:!1,otaId:"",sub_text:"立即创建",uploadUrl:"http://www.aituyou.com:12105/api/v1/ota/uploadfile",allDisabled:!1,getForm:{},List:[],form:{type:"",name:"",version:"",checksum:"",description:"",whiteList:"",blackList:"",updateMode:"全量",forceMode:!0,fromVersion:"",offTime:"",models:""},prams:"",fileList:[],otaList:[]}},compontents:{},created:function(){this.init(),this.getList(this.form.type)},mounted:function(){},computed:{},methods:{init:function(){var e=this,t=(0,c.getPrams)(location.href);if(this.form.type=t.type,this.left_init(t),t&&"edit"==t.type||"read"==t.type){if(null==this.$store.state.verList)return void this.$message({type:"error",message:"数据获取错误",onClose:function(){e.$router.go(-1)}});var r=this.$store.state.verList.filter(function(e){return e.id==t.id});this.getForm=r[0];for(var o in r[0].configuration)null!=this.form[o]&&(this.form[o]=r[0].configuration[o],"full"==this.form[o]&&(this.form[o]="全量"),"incremental"==this.form[o]&&(this.form[o]="增量"));for(var o in r[0].constraint)null!=this.form[o]&&(this.form[o]=r[0].constraint[o]);r[0].type||(this.hastype=!1),console.log(r[0].fromVersion),this.sub_text="立即更新",this.form.name=r[0].name,this.form.fromVersion=r[0].fromVersion,this.otaId=r[0].id,this.form.version=r[0].version,this.form.description=r[0].description,this.form.checksum=r[0].checksum,this.form.fromVersion=r[0].configuration.fromVersion,this.form.type=r[0].type,this.input_check=!0,r[0].constraint.blackList&&(this.userlist="blackList"),r[0].constraint.whiteList&&(this.userlist="whiteList")}"read"==t.type&&(this.allDisabled="disabled",this.sub_text="发布")},submitUpload:function(){var e=this;return(0,l.default)(s.default.mark(function t(){var r;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.form.type){t.next=3;break}return e.layer("ota类型错误"),t.abrupt("return");case 3:if(e.input_check){t.next=6;break}return e.layer("ota版本号不正确"),t.abrupt("return");case 6:if(e.form.name){t.next=9;break}return e.layer("请输入ota更新名"),t.abrupt("return");case 9:if(e.form.checksum){t.next=12;break}return e.layer("请输入md5"),t.abrupt("return");case 12:if(e.form.updateMode){t.next=15;break}return e.layer("请选择增量类型"),t.abrupt("return");case 15:if("whiteList"!=e.userlist||e.form.whiteList){t.next=18;break}return e.layer("请填写白名单"),t.abrupt("return");case 18:if("blackList"!=e.userlist||e.form.blackList){t.next=21;break}return e.layer("请填写黑名单"),t.abrupt("return");case 21:if(e.form.description){t.next=24;break}return e.layer("请填写描述"),t.abrupt("return");case 24:e.prams="?id="+e.otaId+"&",e.pram_data={id:e.otaId};for(r in e.form)e.form[r]?("全量"==e.form[r]&&(e.form[r]="full"),"增量"==e.form[r]&&(e.form[r]="incremental"),e.prams+=r+"="+e.form[r]+"&",e.pram_data[r]=e.form[r]):"offTime"==r&&"deviceApp"==e.form.type&&(e.form.offTime=30,e.prams+=r+"="+e.form[r]+"&",e.pram_data[r]=e.form[r]);e.prams=e.prams.substring(0,e.prams.length-1),e.submit();case 29:case"end":return t.stop()}},t,e)}))()},layer:function(e,t){var r=this;this.$parent.showAlert=!0,this.$parent.alertText=e,setTimeout(function(){r.$parent.showAlert=!1,t()},1e3)},upload_suc:function(e){this.otaId=e.res.otaId,this.$message({type:"success",message:e.ch})},upload_err:function(e){this.layer("上传失败")},getblur:function(){this.blur=!0,/^(\d+\.){2,}\d+$/.test(this.form.version)?this.input_check=!0:this.input_check=!1},getfocus:function(){this.blur=!1},searchId:function(){var e=this;return(0,l.default)(s.default.mark(function t(){var r;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,n.getOtaId)();case 2:r=t.sent,e.otaList=r.res.reverse().splice(0,6);case 4:case"end":return t.stop()}},t,e)}))()},copyId:function(e){this.otaId=e.id},getList:function(e){var t=this;return(0,l.default)(s.default.mark(function r(){var o;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,n.getavList)(e);case 2:o=r.sent,t.List=o.res;case 4:case"end":return r.stop()}},r,t)}))()},submit:function(){var e=this,t=(0,c.getPrams)(location.href);return"edit"==t.type?void(0,n.ud_Ver)(this.prams).then(function(t){0==t.code?e.$message({type:"success",message:"更新成功",onClose:function(){e.$router.go(-1)}}):e.layer(t.ch)}):"read"==t.type?""==this.getForm.available?void this.layer("发布失败：该版本已经发布",function(){e.$router.go(-1)}):void(0,n.publishVer)(this.otaId).then(function(t){0==t.code?e.$message({type:"success",message:"发布成功",onClose:function(){e.$router.go(-1)}}):e.layer(t.ch)}):void(0,n.add_Ver)(this.pram_data).then(function(t){0==t.code?e.$message({type:"success",message:"新增成功",onClose:function(){e.$router.go(-1)}}):e.layer(t.ch)})},left_init:function(e){var t=this;e&&"edit"!=e.type&&this.$parent.$on("addVer",function(){var e=(0,c.getPrams)(location.href);t.form=null,t.form={type:"",otaId:"",name:"",version:"",checksum:"",description:"",whiteList:"",blackList:"",updateMode:"全量",forceMode:!0,fromVersion:"",offTime:"",models:""},t.List=[],t.sub_text="立即创建",t.hastype="disabled",t.allDisabled=!1,t.userlist="",t.fileList=[],t.otaList=[],t.blur=!1,t.input_check=!1,t.form.type=e.type,t.getList(e.type)})}}}},195:function(e,t,r){t=e.exports=r(1)(),t.push([e.id,".container .el-form[data-v-01fd0c7c]{position:absolute;left:0;top:0;bottom:0;right:0;width:44%;min-width:300px}.container .el-form .user[data-v-01fd0c7c]{position:relative}.container .el-form .user .userList[data-v-01fd0c7c]{position:absolute;right:-105%}.container .el-form .user .upMode[data-v-01fd0c7c]{width:54%;position:absolute;left:106%;top:-.1rem}.container .input_tips[data-v-01fd0c7c]{position:absolute;left:105%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.container .otaId[data-v-01fd0c7c]{position:absolute;left:25%;top:0}","",{version:3,sources:["/./src/page/version/addVer.vue"],names:[],mappings:"AACA,qCAAqC,kBAAkB,OAAO,MAAM,SAAS,QAAQ,UAAU,eAAe,CAC7G,AACD,2CAA2C,iBAAiB,CAC3D,AACD,qDAAqD,kBAAkB,WAAW,CACjF,AACD,mDAAmD,UAAU,kBAAkB,UAAU,UAAU,CAClG,AACD,wCAAwC,kBAAkB,UAAU,QAAQ,mCAAmC,AAA+B,0BAA0B,CACvK,AACD,mCAAmC,kBAAkB,SAAS,KAAK,CAClE",file:"addVer.vue",sourcesContent:["\n.container .el-form[data-v-01fd0c7c]{position:absolute;left:0;top:0;bottom:0;right:0;width:44%;min-width:300px\n}\n.container .el-form .user[data-v-01fd0c7c]{position:relative\n}\n.container .el-form .user .userList[data-v-01fd0c7c]{position:absolute;right:-105%\n}\n.container .el-form .user .upMode[data-v-01fd0c7c]{width:54%;position:absolute;left:106%;top:-.1rem\n}\n.container .input_tips[data-v-01fd0c7c]{position:absolute;left:105%;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%)\n}\n.container .otaId[data-v-01fd0c7c]{position:absolute;left:25%;top:0\n}\n"],sourceRoot:"webpack://"}])},256:function(e,t,r){var o=r(195);"string"==typeof o&&(o=[[e.id,o,""]]);r(4)(o,{});o.locals&&(e.exports=o.locals)},294:function(e,t,r){r(256);var o=r(3)(r(142),r(296),"data-v-01fd0c7c",null);e.exports=o.exports},296:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[r("el-form-item",{staticClass:"user",attrs:{label:"ota类型"}},[r("el-select",{attrs:{placeholder:"无",id:"type",disabled:e.hastype},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[r("el-option",{attrs:{label:"deviceApp",value:"deviceApp"}}),e._v(" "),r("el-option",{attrs:{label:"mobileApp",value:"mobileApp"}}),e._v(" "),r("el-option",{attrs:{label:"rom",value:"rom"}}),e._v(" "),r("el-option",{attrs:{label:"patch",value:"patch"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"ota_file",disabled:e.allDisabled}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.uploadUrl,name:"ota","on-success":e.upload_suc,"on-error":e.upload_err,"file-list":e.fileList}},[r("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("立即上传")]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("上传成功后，会返回otaId。若丢失，请自行查找(最多只有近6次otaId)")])],1),e._v(" "),r("el-col",{staticClass:"otaId",attrs:{span:18}},[r("el-popover",{ref:"popover",attrs:{placement:"right",width:"400",trigger:"click"},on:{show:e.searchId}},[r("el-table",{attrs:{data:e.otaList},on:{"row-click":e.copyId}},[r("el-table-column",{attrs:{width:"200",property:"fileName",label:"文件名"}}),e._v(" "),r("el-table-column",{attrs:{width:"200",property:"id",label:"otaId"}})],1)],1),e._v(" "),r("el-input",{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],attrs:{placeholder:"请输入otaId",icon:"search",disabled:e.allDisabled},model:{value:e.otaId,callback:function(t){e.otaId=t},expression:"otaId"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"ota版本"}},[r("el-input",{attrs:{placeholder:"版本格式：1.1.1",spellcheck:"false",disabled:e.allDisabled},on:{blur:e.getblur,focus:e.getfocus},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}}),e.blur&&e.input_check?r("span",{staticClass:"el-icon-circle-check input_tips",staticStyle:{color:"#13CE66"}}):e._e(),e.blur&&!e.input_check?r("span",{staticClass:"el-icon-circle-cross input_tips",staticStyle:{color:"#CB533F"}}):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"ota更新名"}},[r("el-input",{attrs:{placeholder:"请输入更新名称",disabled:e.allDisabled},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"md5"}},[r("el-input",{attrs:{placeholder:"请输入md5字符串",disabled:e.allDisabled},model:{value:e.form.checksum,callback:function(t){e.$set(e.form,"checksum",t)},expression:"form.checksum"}})],1),e._v(" "),"patch"!=e.form.type?r("el-form-item",{staticClass:"user",attrs:{label:"增量类型"}},[r("el-radio-group",{attrs:{disabled:e.allDisabled},model:{value:e.form.updateMode,callback:function(t){e.$set(e.form,"updateMode",t)},expression:"form.updateMode"}},[r("el-radio",{attrs:{label:"全量"}}),e._v(" "),r("el-radio",{attrs:{label:"增量"}})],1),e._v(" "),"增量"==e.form.updateMode?r("el-select",{staticClass:"upMode",attrs:{placeholder:"选择可更新的版本来源",disabled:e.allDisabled},model:{value:e.form.fromVersion,callback:function(t){e.$set(e.form,"fromVersion",t)},expression:"form.fromVersion"}},e._l(e.List,function(e,t){return r("el-option",{attrs:{label:"v"+e,value:e}})})):e._e()],1):e._e(),e._v(" "),r("el-form-item",{staticClass:"user",attrs:{label:"黑白名单"}},[r("el-select",{attrs:{placeholder:"无",disabled:e.allDisabled},model:{value:e.userlist,callback:function(t){e.userlist=t},expression:"userlist"}},[r("el-option",{attrs:{label:"无",value:"0"}}),e._v(" "),r("el-option",{attrs:{label:"黑",value:"blackList"}}),e._v(" "),r("el-option",{attrs:{label:"白",value:"whiteList"}})],1),e._v(" "),"blackList"==e.userlist?r("el-input",{staticClass:"userList",attrs:{type:"textarea",rows:16,placeholder:"黑名单, 这些设备deviceId不可升级, 每个用逗号隔开 e.g “xbot3424343434,xbot89890890809”",disabled:e.allDisabled},model:{value:e.form.blackList,callback:function(t){e.$set(e.form,"blackList",t)},expression:"form.blackList"}}):e._e(),e._v(" "),"whiteList"==e.userlist?r("el-input",{staticClass:"userList",attrs:{type:"textarea",rows:16,placeholder:"白名单, 仅这些设备deviceId可升级 每个用逗号隔开 e.g “xbot3424343434,xbot89890890809”",disabled:e.allDisabled},model:{value:e.form.whiteList,callback:function(t){e.$set(e.form,"whiteList",t)},expression:"form.whiteList"}}):e._e()],1),e._v(" "),"mobileApp"!=e.form.type?r("el-form-item",{attrs:{label:"强制开关"}},[r("el-switch",{attrs:{"on-text":"","off-text":"",disabled:e.allDisabled},model:{value:e.form.forceMode,callback:function(t){e.$set(e.form,"forceMode",t)},expression:"form.forceMode"}})],1):e._e(),e._v(" "),"deviceApp"==e.form.type?r("el-form-item",{attrs:{label:"熄火时间"}},[r("el-input",{attrs:{placeholder:"单位（秒/s），未填默认为30",disabled:e.allDisabled},model:{value:e.form.offTime,callback:function(t){e.$set(e.form,"offTime",t)},expression:"form.offTime"}})],1):e._e(),e._v(" "),"patch"==e.form.type?r("el-form-item",{attrs:{label:"补丁版本"}},[r("el-input",{attrs:{disabled:e.allDisabled},model:{value:e.form.comversion,callback:function(t){e.$set(e.form,"comversion",t)},expression:"form.comversion"}})],1):e._e(),e._v(" "),"mobileApp"!=e.form.type?r("el-form-item",{attrs:{label:"设备型号"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入设备型号，每个用逗号隔开(xbot3424343434,xbot89890890809)",disabled:e.allDisabled},model:{value:e.form.models,callback:function(t){e.$set(e.form,"models",t)},expression:"form.models"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"版本描述"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入该版本功能描述",disabled:e.allDisabled},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v(e._s(e.sub_text))]),e._v(" "),r("el-button",{on:{click:function(t){e.$router.go(-1)}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}}});